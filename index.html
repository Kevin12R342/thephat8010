<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GDQP - Bánh Mì Pita (Lucky Clock)</title>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Palette màu hiện đại */
            --bg-body: #051010;
            --bg-gradient: radial-gradient(circle at 50% 10%, #1a3c3c 0%, #051010 100%);
            
            --glass-bg: rgba(22, 43, 43, 0.65);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-blur: 12px;
            
            --accent: #00e5ff; /* Cyan sáng neon */
            --accent-glow: rgba(0, 229, 255, 0.4);
            
            --accent-red: #ff5252;
            --accent-blue: #448aff;
            
            --text-light: #ffffff;
            --text-dim: #b0bec5;
        }

        * { box-sizing: border-box; font-family: 'Be Vietnam Pro', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg-body);
            background-image: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-light);
            margin: 0; padding: 0; min-height: 100vh;
            display: flex; flex-direction: column;
            overflow: hidden; 
        }

        input, select, textarea { font-size: 16px !important; }

        /* Scrollbar đẹp hơn */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr 300px;
            gap: 25px; padding: 25px;
            height: 100vh; max-width: 1800px; margin: 0 auto;
        }

        /* GLASS CARD STYLE */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            display: flex; flex-direction: column; overflow: hidden;
            transition: transform 0.3s ease;
        }

        /* Mobile Header */
        .mobile-header {
            display: none; justify-content: space-between; align-items: center;
            padding: 15px 20px; 
            background: rgba(5, 16, 16, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border); z-index: 50;
            position: fixed; top: 0; left: 0; width: 100%;
        }
        .hamburger { font-size: 1.5rem; cursor: pointer; color: var(--accent); padding: 5px; }

        /* Cột Trái: Nav */
        .col-nav { grid-column: 1; display: flex; flex-direction: column; gap: 20px; height: 100%; overflow: hidden; }
        .grid-wrapper { flex: 1; overflow-y: auto; padding-right: 5px; }
        .q-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        
        .q-dot {
            aspect-ratio: 1; display: flex; justify-content: center; align-items: center;
            background: rgba(255,255,255,0.05); border-radius: 10px; cursor: pointer;
            font-size: 0.9rem; font-weight: 600; color: var(--text-dim); 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
        }
        .q-dot:hover { background: rgba(255,255,255,0.1); transform: scale(1.05); }
        .q-dot.active { 
            border-color: var(--accent); 
            box-shadow: 0 0 10px var(--accent-glow);
            color: var(--accent);
            background: rgba(0, 229, 255, 0.1);
        }
        .q-dot.correct { background: #00c853; color: white; box-shadow: 0 0 10px rgba(0, 200, 83, 0.4); }
        .q-dot.wrong { background: var(--accent-red); color: white; }
        .q-dot.answered { background: var(--accent-blue); color: white; }

        /* Cột Giữa: Main Question */
        .col-main { grid-column: 2; display: flex; flex-direction: column; height: 100%; }
        .question-box { flex: 1; padding: 40px; overflow-y: auto; display: flex; flex-direction: column; position: relative; }
        
        .q-header { 
            display: flex; justify-content: space-between; margin-bottom: 25px; 
            color: var(--accent); font-weight: 700; letter-spacing: 1px;
            text-shadow: 0 0 10px var(--accent-glow);
        }
        
        /* Animation cho câu hỏi */
        .fade-in-up { animation: fadeInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .q-text { 
            font-size: 1.3rem; font-weight: 600; line-height: 1.5; margin-bottom: 30px; 
            text-align: justify; color: #ffffff;
        }

        .opt-list { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; }
        .opt-btn {
            background: rgba(255, 255, 255, 0.03); 
            padding: 18px 20px; border-radius: 15px;
            cursor: pointer; transition: all 0.2s; 
            border: 1px solid rgba(255,255,255,0.05);
            font-size: 1.05rem; color: var(--text-light); display: flex; align-items: center;
        }
        .opt-btn:hover:not(.disabled) {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
            border-color: rgba(255,255,255,0.2);
        }
        .opt-char { 
            font-weight: 800; margin-right: 15px; min-width: 30px; height: 30px;
            display: flex; align-items: center; justify-content: center;
            background: rgba(0, 229, 255, 0.1); color: var(--accent); 
            border-radius: 8px; flex-shrink: 0;
        }
        
        .opt-btn.correct { background: rgba(0, 200, 83, 0.2); border-color: #00c853; }
        .opt-btn.wrong { background: rgba(255, 82, 82, 0.2); border-color: #ff5252; opacity: 0.9; }
        .opt-btn.selected { background: rgba(68, 138, 255, 0.2); border-color: #448aff; box-shadow: 0 0 15px rgba(68, 138, 255, 0.2); }
        .opt-btn.disabled { pointer-events: none; }

        /* Footer Buttons */
        .nav-footer { margin-top: auto; display: flex; gap: 20px; }
        .btn {
            padding: 16px; border: none; border-radius: 12px; font-weight: 700;
            font-size: 1rem; cursor: pointer; color: white; flex: 1;
            transition: all 0.2s; letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .btn:active { transform: scale(0.98); }
        
        .btn-prev { background: rgba(255,255,255,0.1); color: var(--text-dim); }
        .btn-prev:hover { background: rgba(255,255,255,0.15); color: white; }
        
        .btn-next { 
            background: linear-gradient(135deg, #00b8d4 0%, #00e5ff 100%); 
            color: #00363a; box-shadow: 0 5px 15px rgba(0, 229, 255, 0.3);
        }
        .btn-next:hover { box-shadow: 0 8px 20px rgba(0, 229, 255, 0.5); transform: translateY(-2px); }

        /* Cột Phải: Info */
        .col-info { grid-column: 3; display: flex; flex-direction: column; gap: 20px; }
        .info-card { padding: 25px; text-align: center; justify-content: center; }
        .timer-display { 
            font-size: 2.5rem; font-weight: 800; color: white; font-family: 'Courier New', monospace; 
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
            margin-top: 5px;
        }
        
        /* Start Screen */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #051010; 
            background-image: var(--bg-gradient);
            z-index: 1000;
            display: flex; justify-content: center; align-items: center; padding: 20px;
        }
        .start-form {
            background: rgba(22, 43, 43, 0.85); /* Đậm hơn chút để đọc chữ dễ hơn */
            backdrop-filter: blur(25px);
            padding: 30px 40px; border-radius: 25px;
            width: 100%; max-width: 550px; /* Rộng hơn chút để chứa câu quote dài */
            border: 1px solid var(--accent);
            box-shadow: 0 20px 60px rgba(0,0,0,0.8); 
            display: flex; flex-direction: column; gap: 15px;
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 90vh; /* Phòng trường hợp màn hình điện thoại bé */
            overflow-y: auto;
        }
        
        /* CLOCK STYLES */
        .realtime-box {
            text-align: center;
            margin-bottom: 5px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .rt-time {
            font-size: 2.5rem;
            font-weight: 800;
            font-family: 'Courier New', monospace;
            color: var(--accent);
            text-shadow: 0 0 15px var(--accent-glow);
            line-height: 1.1;
        }
        .rt-date {
            font-size: 0.85rem;
            color: var(--text-dim);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 5px;
        }

        /* QUOTE BOX STYLE */
        .quote-box {
            background: rgba(0, 229, 255, 0.05);
            border-left: 3px solid var(--accent);
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 5px;
        }
        .quote-label {
            font-size: 0.75rem; color: var(--accent); font-weight: 700; 
            text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;
            display: flex; align-items: center; gap: 5px;
        }
        .quote-text {
            font-size: 0.9rem; font-style: italic; color: #e0f2f1; line-height: 1.5; text-align: justify;
        }
        .quote-author {
            text-align: right; font-size: 0.8rem; font-weight: 700; color: var(--accent); margin-top: 5px;
        }

        .inp-field {
            width: 100%; padding: 14px; background: rgba(0,0,0,0.4); 
            border: 1px solid var(--glass-border);
            color: white; border-radius: 12px; outline: none;
            transition: 0.3s;
        }
        .inp-field:focus { border-color: var(--accent); box-shadow: 0 0 10px var(--accent-glow); }

        .mode-btn {
            padding: 12px; border-radius: 12px; border: 1px solid var(--glass-border);
            background: rgba(255,255,255,0.05); color: var(--text-dim); cursor: pointer;
            font-weight: 600; transition: 0.3s; text-align: center; position: relative; overflow: hidden;
        }
        .mode-btn:hover { background: rgba(255,255,255,0.1); }
        .mode-btn.active { 
            background: rgba(0, 229, 255, 0.15); color: var(--accent); 
            border-color: var(--accent); 
        }

        /* RESULT MODAL */
        #result-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 16, 16, 0.95); 
            backdrop-filter: blur(10px); z-index: 2000;
            display: none; justify-content: center; align-items: center; padding: 20px;
        }
        .result-content {
            background: #162b2b; padding: 40px; border-radius: 30px;
            width: 100%; max-width: 550px; text-align: center;
            border: 2px solid var(--accent);
            box-shadow: 0 0 50px var(--accent-glow);
            animation: popIn 0.4s ease-out;
        }
        @keyframes popIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }

        /* --- MOBILE RESPONSIVE FIX --- */
        @media (max-width: 900px) {
            body { overflow: auto !important; display: block; height: auto; }
            .app-container { display: block; padding: 15px; padding-top: 80px; height: auto; min-height: 100vh; overflow: visible; }
            .mobile-header { display: flex; }
            .col-nav, .col-info { 
                position: fixed; top: 0; right: -100%; width: 300px; height: 100%;
                background: #0f2424; z-index: 100; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding: 20px;
                box-shadow: -10px 0 30px rgba(0,0,0,0.8); overflow-y: auto; border-left: 1px solid var(--glass-border);
            }
            .col-nav.open { right: 0; }
            .col-main { width: 100%; height: auto; display: block; }
            
            /* PADDING BOTTOM ĐỂ KHÔNG BỊ CHE BỞI NÚT */
            .question-box { 
                border: none; 
                border-radius: 20px; 
                padding: 25px; 
                padding-bottom: 130px; 
                background: var(--glass-bg); 
                overflow: visible; 
                height: auto; 
                display: block; 
                margin-bottom: 0; 
            }
            
            .q-text { font-size: 1.15rem; }
            .opt-btn { padding: 15px; }
            
            /* Thanh nút bấm cố định dưới cùng */
            .nav-footer { 
                position: fixed; bottom: 0; left: 0; width: 100%; 
                background: rgba(5, 16, 16, 0.95); backdrop-filter: blur(10px);
                padding: 15px; border-top: 1px solid var(--glass-border); z-index: 40; margin: 0;
            }
            
            #overlay-bg {
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); z-index: 90; display: none;
            }
            #overlay-bg.show { display: block; }
            
            /* Chỉnh lại Start Screen trên mobile */
            .start-form { padding: 25px; max-width: 100%; }
            .rt-time { font-size: 2rem; }
            .quote-text { font-size: 0.85rem; }
        }
    </style>
</head>
<body>

<div id="start-screen">
    <div class="start-form">
        <h2 style="text-align:center; color:var(--accent); margin:0; text-transform: uppercase; letter-spacing: 2px; font-size: 1.2rem;">Luyện thi GDQP</h2>
        
        <div class="realtime-box">
            <div class="rt-time" id="rt-time">00:00:00</div>
            <div class="rt-date" id="rt-date">Đang tải...</div>
        </div>

        <div class="quote-box">
            <div class="quote-label">★ THÔNG ĐIỆP MAY MẮN ★</div>
            <div class="quote-text">
                "Thất bại không phải là phủ nhận nỗ lực, mà đôi khi chỉ là sự trêu đùa của may mắn. Đừng coi đó là dấu chấm hết, hãy xem như trạm dừng chân để nạp đầy kinh nghiệm và động lực. Cậu chỉ thực sự thua cuộc khi bạn chấp nhận buông xuôi. Đừng khóc vì thất bại ngày hôm nay hãy để những giọt nước mắt đó cho sự hạnh phúc của tương lai."
            </div>
            <div class="quote-author">— PITA —</div>
        </div>
        
        <input type="text" id="username" class="inp-field" placeholder="Nhập tên chiến sĩ (Bắt buộc)...">
        <input type="text" id="yt-link" class="inp-field" placeholder="Link nhạc YouTube (Tùy chọn)">
        
        <div style="display:flex; gap:10px;">
            <div class="mode-btn active" id="mode-practice" onclick="selectMode('practice')" style="flex:1;">
                <div style="font-size:1rem; margin-bottom: 2px;">LUYỆN TẬP</div>
                <div style="font-size:0.7rem; font-weight:400; opacity:0.7;">Full ngân hàng<br>Biết đáp án ngay</div>
            </div>
            <div class="mode-btn" id="mode-exam" onclick="selectMode('exam')" style="flex:1;">
                <div style="font-size:1rem; margin-bottom: 2px;">THỰC CHIẾN</div>
                <div style="font-size:0.7rem; font-weight:400; opacity:0.7;">30 Câu ngẫu nhiên<br>Áp lực thời gian</div>
            </div>
        </div>

        <button class="btn btn-next" style="width:100%; margin-top: 5px; font-size: 1rem;" onclick="startQuiz()">VÀO LÀM BÀI NGAY</button>
    </div>
</div>

<div id="result-modal">
    <div class="result-content">
        <h2 style="color:var(--accent); margin-top:0; text-transform: uppercase;">Kết quả thi</h2>
        <div id="res-score" style="font-size:3.5rem; font-weight:800; color:white; margin:15px 0; text-shadow: 0 0 20px var(--accent-glow);">0.0</div>
        <div style="font-size:1.1rem; margin-bottom:25px; color:var(--text-dim);">ĐIỂM SỐ (Thang 10)</div>
        
        <div id="res-msg" style="background:rgba(255,255,255,0.05); padding:25px; border-radius:15px; margin-bottom:25px; font-style:italic; color:#e0f2f1; line-height: 1.6; text-align: justify; border: 1px solid rgba(255,255,255,0.1);">
            </div>

        <div id="res-img" style="margin-bottom:25px; display:none;">
            <img src="https://i.pinimg.com/originals/24/f1/35/24f135062c3328e1844a475d68804473.png" alt="Chim sáo" style="width:140px; height:auto; border-radius:50%; border:4px solid #FFD700; box-shadow: 0 0 30px rgba(255, 215, 0, 0.6); animation: popIn 0.6s ease;">
            <div style="color:#FFD700; font-size:1rem; margin-top:10px; font-weight: 700;">Chim Sáo May Mắn</div>
        </div>

        <div style="display:flex; gap:15px;">
            <button class="btn" style="background:#37474f;" onclick="reviewQuiz()">XEM LẠI BÀI</button>
            <button class="btn btn-next" onclick="location.reload()">THOÁT RA</button>
        </div>
    </div>
</div>

<div class="mobile-header">
    <div style="font-weight:800; color:var(--accent); letter-spacing: 1px;">PITA GDQP</div>
    <div style="font-family:'Courier New', monospace; font-weight:700; font-size:1.3rem;" id="timer-mobile">--:--</div>
    <div class="hamburger" onclick="toggleMenu()">
        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 12H21" stroke="#00e5ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 6H21" stroke="#00e5ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 18H21" stroke="#00e5ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </div>
</div>

<div id="overlay-bg" onclick="toggleMenu()"></div>

<div class="app-container" id="main-app" style="opacity: 0; transition: opacity 0.5s;">
    
    <div class="col-nav" id="sidebar">
        <div class="card info-card">
            <div style="color:var(--text-dim); font-size:0.8rem; letter-spacing: 1px;">THÍ SINH</div>
            <div style="font-weight:700; font-size:1.3rem; color:var(--accent); margin: 5px 0;" id="user-display">---</div>
            <div style="font-size:0.8rem; background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 20px; display: inline-block;" id="mode-display">---</div>
        </div>
        <div class="card" style="flex:1; padding:20px; display:flex; flex-direction:column;">
            <div class="grid-wrapper">
                <div class="q-grid" id="q-grid"></div>
            </div>
            <button class="btn" style="background: linear-gradient(135deg, #ef5350, #c62828); margin-top:15px; box-shadow: 0 5px 15px rgba(239, 83, 80, 0.4);" onclick="confirmFinish()">NỘP BÀI THI</button>
        </div>
    </div>

    <div class="col-main">
        <div class="card question-box">
            <div class="q-header">
                <span style="display:flex; align-items:center; gap:8px;">
                    <span style="width:8px; height:8px; background:var(--accent); border-radius:50%; box-shadow: 0 0 8px var(--accent);"></span>
                    MÔN: GDQP-AN
                </span>
                <span id="q-current-txt" style="background: rgba(0, 229, 255, 0.1); padding: 4px 12px; border-radius: 12px;">Câu 1/--</span>
            </div>
            <div id="q-content-area" class="fade-in-up"></div>
            <div class="nav-footer">
                <button class="btn btn-prev" onclick="changeQuestion(-1)">❮ Quay lại</button>
                <button class="btn btn-next" onclick="changeQuestion(1)">Tiếp theo ❯</button>
            </div>
        </div>
    </div>

    <div class="col-info">
        <div class="card info-card">
            <div style="color:var(--text-dim); font-size:0.8rem;">THỜI GIAN CÒN LẠI</div>
            <div class="timer-display" id="timer-desktop">--:--</div>
        </div>
        <div class="card info-card" id="live-score-box">
            <div style="color:var(--text-dim); font-size:0.8rem;">SỐ CÂU ĐÚNG</div>
            <div style="font-size:2rem; color:var(--accent); font-weight:700; text-shadow: 0 0 15px var(--accent-glow); margin-top:5px;" id="score-display">0 / --</div>
        </div>
        <div id="yt-wrapper" style="width:1px; height:1px; overflow:hidden; opacity:0;"></div>
    </div>
</div>

<script>
    // --- CLOCK LOGIC ---
    function updateRealTime() {
        const now = new Date();
        const h = String(now.getHours()).padStart(2, '0');
        const m = String(now.getMinutes()).padStart(2, '0');
        const s = String(now.getSeconds()).padStart(2, '0');
        
        const days = ['Chủ Nhật', 'Thứ Hai', 'Thứ Ba', 'Thứ Tư', 'Thứ Năm', 'Thứ Sáu', 'Thứ Bảy'];
        const dayName = days[now.getDay()];
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const year = now.getFullYear();

        document.getElementById('rt-time').innerText = `${h}:${m}:${s}`;
        document.getElementById('rt-date').innerText = `${dayName}, ${day}/${month}/${year}`;
    }
    setInterval(updateRealTime, 1000);
    updateRealTime();

    // --- DỮ LIỆU CÂU HỎI ---
    const originalBank = [
        {q: "Trong chiến tranh bảo vệ biên giới Tây Nam của Tổ quốc và cùng quân dân Cam-pu-chia chiến thắng chế độ diệt chủng (gọi tắt là chiến tranh bảo vệ biên giới Tây Nam của Tổ quốc), tập đoàn Pôn Pốt – Iêng Xary phát động chiến tranh xâm lược Việt Nam vào ngày", options: ["30-4-1975.", "30-4-1978.", "30-4-1977.", "30-4-1976."], a: 2}, 
        {q: "Cho thông tin sau: “Trong chiến tranh bảo vệ biên giới Tây Nam của Tổ quốc, ngày (.....), Bộ Chính trị và Quân uỷ Trung ương quyết định phát động chiến tranh nhân dân, kiên quyết phản công và tiến công tập đoàn Pôn Pốt – Iêng Xary một cách chủ động, liên tục bằng mọi lực lượng”. Thông tin cần điền vào chỗ (….) trong câu trên là:", options: ["15-6-1976", "15-6-1977", "15-6-1978", "15-6-1979"], a: 2}, 
        {q: "Trong chiến tranh bảo vệ biên giới Tây Nam của Tổ quốc, Mặt trận Đoàn kết dân tộc cứu nước Cam-pu-chia được thành lập vào ngày", options: ["02-12-1976.", "02-12-1977.", "02-12-1978.", "02-12-1979."], a: 2}, 
        {q: "Trong chiến tranh bảo vệ biên giới Tây Nam của Tổ quốc, tập đoàn Pôn Pốt – Iêng Xary mở cuộc tiến công trên toàn tuyến biên giới Tây Nam nước ta vào ngày", options: ["23-12-1975.", "23-12-1976.", "23-12-1977.", "23-12-1978."], a: 3}, 
        {q: "Trong chiến tranh bảo vệ biên giới Tây Nam của Tổ quốc, thủ đô Phnôm Pênh hoàn toàn được giải phóng vào ngày", options: ["07-01-1976.", "07-01-1977.", "07-01-1978.", "07-01-1979."], a: 3}, 
        {q: "Cho thông tin sau: “Một trong những nét chính nghệ thuật quân sự trong chiến tranh bảo vệ biên giới Tây Nam của Tổ quốc là: nhận thức, đánh giá đúng âm mưu, bản chất, thủ đoạn của đối tượng tác chiến; chủ động tiến hành (.....). Từ ngữ cần điền vào chỗ (.....) trong câu trên là", options: ["chiến tranh nhân dân", "chiến tranh nhân dân tại chỗ", "chiến tranh nhân dân tại chỗ rộng khắp", "chiến tranh nhân dân tại chỗ đồng loạt"], a: 2}, 
        {q: "Cho thông tin sau: “Ngày (.....), chính quyền Trung Quốc huy động lực lượng lớn tiến công sang lãnh thổ Việt Nam; phối hợp bộ binh, xe tăng, xe bọc thép và pháo binh đánh chiếm một số thị xã, tàn phá cơ sở hạ tầng, bệnh viện, trường học, gây nhiều tổn thất về người và tài sản ở các tỉnh dọc biên giới phía Bắc nước ta, từ Quảng Ninh đến Lai Châu”. Thông tin cần điền vào chỗ (…..) trong câu trên là:", options: ["17-02-1978", "17-3-1978", "17-02-1979", "17-3-1979"], a: 2}, 
        {q: "Trong cuộc chiến đấu bảo vệ biên giới phía Bắc của Tổ quốc, Chủ tịch nước Cộng hoà xã hội chủ nghĩa Việt Nam công bố Lệnh Tổng động viên trong cả nước để bảo vệ Tổ quốc vào ngày", options: ["05-01-1979.", "05-02-1979.", "05-3-1979.", "05-4-1979."], a: 2}, 
        {q: "Cho thông tin sau: “Trong cuộc chiến đấu bảo vệ biên giới phía Bắc của Tổ quốc, đến ngày (.….), về cơ bản, Trung Quốc đã rút quân khỏi nước ta”. Thông tin cần điền vào chỗ (…..) trong câu trên là:", options: ["15-3-1979", "16-3-1979", "17-3-1979", "18-3-1979"], a: 3}, 
        {q: "Chính quyền Trung Quốc dùng vũ lực đánh chiếm nhóm đảo phía Tây quần đảo Hoàng Sa vào năm", options: ["1971.", "1972.", "1973.", "1974."], a: 3}, 
        {q: "Chính quyền Trung Quốc sử dụng vũ lực chiếm đóng trái phép một số bãi đá thuộc quần đảo Trường Sa của Việt Nam: Chữ Thập, Châu Viên, Ga Ven, Tư Nghĩa, Gạc Ma, Xu Bi vào năm", options: ["1986.", "1987.", "1988.", "1989."], a: 2}, 
        {q: "Hiện nay hệ thống nhà trường quân đội có bao nhiêu học viện và các trường sĩ quan, đại học:", options: ["10 học viện - 11 trường sĩ quan, đại học", "11 học viện - 10 trường sĩ quan, đại học", "9 học viện - 11 trường sĩ quan, đại học", "10 học viện - 12 trường sĩ quan, đại học"], a: 0}, 
        {q: "Cho thông tin sau: “Một trong những yêu cầu đối với công tác tuyển sinh, đào tạo trong các trường Quân đội, Công an là: tổ chức tuyển sinh (.....); tạo đồng thuận của thí sinh, gia đình thí sinh và xã hội”. Từ ngữ cần điền vào chỗ (.....) trong câu trên là:", options: ["đúng pháp luật, dân chủ, công khai, minh bạch, chính xác, công bằng", "đúng quy chế, dân chủ, công khai, minh bạch, chính xác, công bằng", "đúng quy định, dân chủ, công tâm, công khai, công bằng, minh bạch", "đúng hướng dẫn, công tâm, công khai, công minh, công bằng, chính xác"], a: 0}, 
        {q: "Trong những câu sau, câu nào nói về nghĩa vụ của học viên trường Quân đội, Công an?", options: ["Học viên được bảo đảm cơ sở vật chất, trang thiết bị, đồ dùng phục vụ học tập.", "Học viên được nghỉ hè, nghỉ ngày cuối tuần, ngày lễ, ngày Tết.", "Học viên sẵn sàng nhận nhiệm vụ theo phân công của Bộ Quốc phòng, Bộ Công an khi ra trường.", "Học viên được hưởng chế độ khen thưởng theo quy định của Bộ Quốc phòng, Bộ Công an."], a: 2}, 
        {q: "Trong các cơ sở đào tạo sau của Quân đội, cơ sở đào tạo nào không tuyển học sinh trung học phổ thông?", options: ["Học viện Hậu cần", "Học viện Lục quân", "Học viện Biên phòng", "Học viện Quân y"], a: 1}, 
        {q: "Hạ sĩ quan, binh sĩ tại ngũ theo quy định của pháp luật về nghĩa vụ quân sự thuộc đối tượng tuyển sinh đào tạo cán bộ cấp phân đội trình độ đại học, cao đẳng hệ chính quy trong các trường Quân đội nếu thời gian phục vụ tại ngũ (tính đến tháng 4 năm tuyển sinh)", options: ["đủ 6 tháng trở lên.", "đủ 9 tháng trở lên.", "đủ 12 tháng trở lên.", "đủ 15 tháng trở lên."], a: 2}, 
        {q: "Quân nhân chuyên nghiệp, công nhân và viên chức quốc phòng thuộc đối tượng tuyển sinh đào tạo cán bộ cấp phân đội trình độ đại học, cao đẳng hệ chính quy trong các trường Quân đội nếu thời gian phục vụ trong Quân đội (tính đến tháng 9 năm tuyển sinh)", options: ["đủ 6 tháng trở lên.", "đủ 12 tháng trở lên.", "đủ 18 tháng trở lên.", "đủ 24 tháng trở lên."], a: 1}, 
        {q: "Thanh niên ngoài Quân đội dự tuyển sinh đào tạo cán bộ cấp phân đội trình độ đại học, cao đẳng hệ chính quy trong các trường Quân đội phải có độ tuổi (tính đến năm dự tuyển)", options: ["không quá 20 tuổi.", "không quá 21 tuổi.", "không quá 22 tuổi.", "không quá 23 tuổi."], a: 1}, 
        {q: "Quân nhân tại ngũ hoặc đã xuất ngũ và công dân hoàn thành nghĩa vụ tham gia Công an nhân dân dự tuyển sinh đào tạo cán bộ cấp phân đội trình độ đại học, cao đẳng hệ chính quy trong các trường Quân đội phải có độ tuổi (tính đến năm dự tuyển)", options: ["không quá 21 tuổi.", "không quá 22 tuổi.", "không quá 23 tuổi.", "không quá 24 tuổi."], a: 2}, 
        {q: "Trong các phương thức sau, phương thức nào không áp dụng đối với tuyển sinh đào tạo cán bộ cấp phân đội trình độ đại học, cao đẳng hệ chính quy trong các trường Quân đội?", options: ["Xét tuyển thẳng, ưu tiên xét tuyển và xét tuyển học sinh giỏi cấp trung học phổ thông.", "Xét tuyển từ kết quả kì thi đánh giá năng lực do các trường đại học trong nước tổ chức.", "Xét tuyển từ kết quả kì thi đánh giá năng lực do các trường đại học nước ngoài tổ chức.", "Xét tuyển từ kì thi đánh giá năng lực do Bộ Quốc phòng tổ chức."], a: 2}, 
        {q: "Thí sinh dự tuyển sinh đào tạo cán bộ cấp phân đội trình độ đại học, cao đẳng hệ chính quy trong các trường Quân đội", options: ["đều phải qua sơ tuyển.", "không phải qua sơ tuyển nếu là học sinh giỏi cấp trung học phổ thông.", "không phải qua sơ tuyển nếu có anh (chị) ruột đã vào học một trường trong Quân đội.", "không phải qua sơ tuyển nếu bố (mẹ) đẻ là quân nhân."], a: 0}, 
        {q: "Ngành nào trong các ngành sau được đào tạo ở Học viện An ninh nhân dân?", options: ["An ninh mạng và phòng chống tội phạm sử dụng công nghệ cao", "Trinh sát kĩ thuật", "Nghiệp vụ cảnh sát", "Kĩ thuật Công an nhân dân"], a: 0}, 
        {q: "Trong các trường hợp sau, trường hợp nào không thuộc đối tượng tuyển sinh đào tạo trình độ đại học chính quy tuyển mới trong trường Công an?", options: ["Chỉ huy từ cấp đội trở lên thuộc Công an đơn vị, địa phương.", "Học sinh Trường Văn hoá.", "Chiến sĩ nghĩa vụ Công an.", "Công dân thường trú tại địa phương nơi đăng kí sơ tuyển."], a: 0}, 
        {q: "Những công việc nào trong các công việc sau không có trong nội dung sơ tuyển thí sinh dự tuyển đào tạo trình độ đại học chính quy tuyển mới trong trường Công an?", options: ["Kiểm tra bằng tốt nghiệp và học bạ trung học phổ thông.", "Thẩm tra, xác minh, kết luận tiêu chuẩn chính trị.", "Kiểm tra sức khoẻ, năng khiếu.", "Chụp ảnh bố đẻ và mẹ đẻ của thí sinh."], a: 3}, 
        {q: "Một trong chức năng, nhiệm vụ của Bộ Quốc phòng là", options: ["tham mưu chiến lược về các chủ trương, chính sách...", "tham mưu với Đảng và Nhà nước về đường lối, nhiệm vụ quân sự, quốc phòng bảo vệ Tổ quốc.", "tham mưu, chỉ đạo xây dựng nền quốc phòng toàn dân.", "tham mưu, chỉ đạo huấn luyện, xây dựng, phát triển lực lượng..."], a: 1}, 
        {q: "Một trong chức năng, nhiệm vụ của Bộ Tổng tham mưu Quân đội nhân dân Việt nam là", options: ["tham mưu, chỉ đạo huấn luyện, xây dựng, phát triển lực lượng, sẵn sàng chiến đấu", "tham mưu chiến lược về các chủ trương, chính sách...", "quản lí nhà nước về lĩnh vực quân sự, quốc phòng...", "tổ chức thực hiện việc xây dựng, quản lí..."], a: 1}, 
        {q: "Một trong chức năng, nhiệm vụ của Tổng cục chính trị Quân đội nhân dân Việt nam là", options: ["giúp Quân uỷ Trung ương quyết định những chủ trương, biện pháp lớn về công tác Đảng, công tác chính trị trong Quân đội.", "quản lí nhà nước về lĩnh vực quân sự, quốc phòng trong phạm vi cả nước.", "chỉ huy, điều hành và tổ chức, chỉ đạo phát triển Quân đội nhân dân, Dân quân tự vệ.", "tổ chức thực hiện việc xây dựng, quản lí, chỉ huy Quân đội nhân dân, Dân quân tự vệ."], a: 0}, 
        {q: "Một trong chức năng, nhiệm vụ của quân khu là", options: ["Tham mưu, chỉ đạo huấn luyện, xây dựng, phát triển lực lượng, sẵn sàng chiến đấu.", "Tham mưu, chỉ đạo xây dựng lực lượng phòng không, không quân, hải quân", "Tham mưu, chỉ đạo xây dựng nền quốc phòng toàn dân.", "Tham mưu, chỉ đạo huấn luyện, xây dựng, phát triển lực lượng chuyên ngành..."], a: 2}, 
        {q: "Một trong chức năng, nhiệm vụ của quân đoàn là", options: ["trực tiếp chiến đấu hoặc bảo đảm chiến đấu, có vũ khí, trang bị kĩ thuật và chiến thuật riêng.", "tham mưu, chỉ đạo huấn luyện, xây dựng, phát triển lực lượng chuyên ngành...", "có thể tác chiến độc lập hoặc đảm nhiệm một hướng chiến dịch.", "tham gia tác chiến hiệp đồng quân, binh chủng."], a: 2}, 
        {q: "Cho thông tin sau: “Quân hiệu của Quân đội nhân dân Việt Nam là (.....) của Quân đội nhân dân Việt Nam.” Từ ngữ cần điền vào chỗ (.....) trong câu trên là", options: ["biểu trưng", "biểu tượng", "hình tượng", "hình ảnh"], a: 1}, 
        {q: "Quân hiệu của Quân đội nhân dân Việt Nam hình tròn, có đường kính", options: ["36 mm hoặc 33 mm hoặc 28 mm.", "38 mm hoặc 35 mm hoặc 30 mm.", "40 mm hoặc 37 mm hoặc 32 mm.", "42 mm hoặc 39 mm hoặc 34 mm."], a: 0}, 
        {q: "Hạ sĩ quan Quân đội nhân dân Việt Nam có", options: ["hai bậc: Hạ sĩ, Trung sĩ.", "hai bậc: Trung sĩ, Thượng sĩ.", "ba bậc: Hạ sĩ, Trung sĩ, Thượng sĩ.", "bốn bậc: Hạ sĩ, Trung sĩ, Thượng sĩ, Đại sĩ."], a: 2}, 
        {q: "Một trong chức năng, nhiệm vụ của Bộ Công an là", options: ["bảo vệ các khu vực làm việc, các hoạt động, hội nghị của Đảng, Nhà nước Việt Nam.", "tham mưu với Đảng, Nhà nước về bảo vệ an ninh quốc gia, bảo đảm trật tự, an toàn xã hội.", "tham mưu, hướng dẫn và tổ chức thực hiện quản lí nhà nước về trật tự xã hội.", "thực hiện biện pháp vũ trang bảo vệ an ninh quốc gia, bảo đảm trật tự, an toàn xã hội."], a: 1}, 
        {q: "Công an hiệu của Công an nhân dân Việt Nam hình tròn, có đường kính", options: ["34 mm.", "35 mm.", "36 mm.", "37 mm."], a: 2}, 
        {q: "Bên ngoài Công an hiệu của Công an nhân dân Việt Nam có cành tùng kép màu vàng bao quanh liền thành một khối", options: ["cao 52 mm, rộng 62 mm", "cao 54 mm, rộng 64 mm", "cao 56 mm, rộng 66 mm", "cao 58 mm, rộng 68 mm"], a: 1}, 
        {q: "Sĩ quan chuyên môn kĩ thuật Công an nhân dân Việt Nam cấp tá", options: ["có một bậc: Thiếu tá.", "có ba bậc: Thiếu tá, Trung tá, Thượng tá.", "có hai bậc: Thiếu tá,Trung tá.", "có bốn bậc: Thiếu tá, Trung tá, Thượng tá, Đại tá."], a: 1}, 
        {q: "Cho thông tin sau: “Phù hiệu Công an nhân dân Việt Nam là (…..) quy định để chỉ tổ chức, lực lượng.” Từ ngữ cần điền vào chỗ (.....) trong câu trên là", options: ["dấu hiệu", "lô-gô", "hình hiệu", "hình ảnh"], a: 0}, 
        {q: "Quần áo, mũ kê pi và cà vạt của Cảnh sát giao thông Việt Nam có màu", options: ["xanh rêu.", "lúa chín vàng.", "vàng.", "xanh lam."], a: 1}, 
        {q: "Ngắm bắn là xác định góc bắn và hướng bắn cho súng để đưa quỹ đạo đường đạn đi qua", options: ["mục tiêu.", "điểm định bắn trúng.", "mục tiêu định bắn trúng.", "điểm định bắn trúng trên mục tiêu."], a: 3}, 
        {q: "Đường ngắm cơ bản là đường thẳng từ mắt người ngắm qua điểm chính giữa mép trên khe ngắm đến", options: ["mép trên đầu ngắm.", "điểm chính giữa mép trên đầu ngắm.", "mục tiêu.", "điểm chính giữa mục tiêu."], a: 1}, 
        {q: "Điểm được xác định trước sao cho khi ngắm vào điểm đó để bắn thì quỹ đạo đường đạn đi qua điểm định bắn trúng trên mục tiêu được gọi là", options: ["điểm ngắm đúng.", "điểm ngắm chụm.", "điểm ngắm trúng.", "điểm ngắm cơ bản."], a: 0}, 
        {q: "Đường ngắm đúng là đường ngắm cơ bản được dóng vào điểm ngắm đã xác định với điều kiện", options: ["mặt súng thăng bằng.", "mặt súng được cố định.", "nòng súng thăng bằng.", "nòng súng được cố định."], a: 0}, 
        {q: "Khi đường ngắm cơ bản đã chính xác và đã có điểm ngắm đúng, nếu mặt súng nghiêng về bên nào thì điểm chạm trên mục tiêu sẽ", options: ["lệch và thấp về bên đó", "lệch và cao về bên đó.", "lệch về bên đó.", "cao về bên đó."], a: 0}, 
        {q: "Động tác nằm bắn không tì súng tiểu liên AK gồm:", options: ["động tác chuẩn bị bắn, động tác bắn, động tác thôi bắn.", "động tác chuẩn bị bắn, động tác bắn, động tác đứng dậy.", "động tác lắp đạn, động tác bắn, động tác tháo đạn.", "động tác gương súng, động tác ngắm, động tác bóp cò."], a: 0}, 
        {q: "Khẩu lệnh bắt đầu thực hiện động tác nằm bắn súng tiểu liên AK (có tì hoặc không có tì) là:", options: ["“Nằm bắn”.", "“Nằm chuẩn bị bắn”.", "“Chuẩn bị”.", "“Chuẩn bị bắn”."], a: 1}, 
        {q: "Trong chuẩn bị tư thế nằm bắn không tì súng tiểu liên AK, khi nghe dứt khẩu lệnh, người bắn về tư thế xách súng, sau đó thực hiện", options: ["2 cử động.", "3 cử động.", "4 cử động.", "5 cử động."], a: 1}, 
        {q: "Ở cử động 1 chuẩn bị tư thế động tác nằm bắn, người bắn bước chân phải lên một bước dài chếch theo hướng mũi bàn chân phải, dùng mũi bàn chân trái làm trụ, xoay gót bàn chân trái sang trái để người hướng theo hướng", options: ["gót bàn chân trái.", "gót bàn chân phải.", "mũi bàn chân trái.", "mũi bàn chân phải."], a: 3}, 
        {q: "Ở cử động 2 chuẩn bị tư thế động tác nằm bắn, người bắn hạ cẳng tay trái xuống đất, khuỷu tay ở phía trước, cách hướng bàn chân phải khoảng", options: ["10 cm.", "15 cm.", "20 cm.", "25 cm."], a: 1}, 
        {q: "Cho thông tin sau: “Trong động tác lắp đạn nằm bắn không tì súng tiểu liên AK, người bắn dùng tay phải tháo hộp tiếp đạn không có đạn ở súng ra, đưa cho tay trái, (...) bàn tay trái kẹp hộp tiếp đạn vào má phải ốp lót tay sao cho cửa hộp tiếp đạn quay vào thân người, sống hộp tiếp đạn hướng xuống đất. Từ ngữ cần điền vào chỗ (...) trong câu trên là:", options: ["dùng ngón út và ngón áp út", "dùng ngón áp út và ngón giữa", "dùng ngón giữa và ngón cái", "dùng ngón trỏ và ngón cái ."], a: 1}, 
        {q: "Khi gương súng trong động tác nằm bắn không tì súng tiểu liên AK phải bảo đảm các yếu tố:", options: ["“bằng, chắc, đều”.", "“chắc, đều, bền”.", "“bằng, chắc, đều, bền”.", "“bằng, chắc, đều, êm”."], a: 2}, 
        {q: "Khi thực hiện động tác ngắm trong kĩ thuật nằm bắn không tì súng tiểu liên AK cần", options: ["áp má phải vào báng súng với lực vừa phải.", "tránh áp má phải vào báng súng.", "áp má phải vào báng súng thật chặt.", "gối má phải lên báng súng."], a: 0}, 
        {q: "Khi thực hiện động tác ngắm trong kĩ thuật nằm bắn không tì súng tiểu liên AK người bắn", options: ["có thể nheo một mắt hoặc mở cả hai mắt.", "bắt buộc phải nheo mắt trái.", "bắt buộc phải nheo mắt phải.", "bắt buộc phải mở hai mắt."], a: 0}, 
        {q: "Cho thông tin sau: “Trong kĩ thuật nằm bắn không tì súng tiểu liên AK, khi bóp cò cần dùng (…) của ngón trỏ tay phải để bóp cò, mặt trong ngón tay trỏ sát gần vào tay cầm. Từ ngữ cần điền vào chỗ (…) trong câu trên là:", options: ["phần cuối đốt thứ hai, đầu đốt thứ ba", "phần cuối đốt thứ nhất, đầu đốt thứ hai", "phần giữa đốt thứ nhất", "phần giữa đốt thứ hai"], a: 1}, 
        {q: "Cho thông tin sau: “Trong kĩ thuật nằm bắn không tì súng tiểu liên AK, khi bóp cò cần bảo đảm (…) theo trục nòng súng đến khi đạn nổ.", options: ["êm, đều, từ từ, thẳng về sau", "êm, đều, nhanh, thẳng về sau", "êm, đều, từ từ, thẳng", "êm, đều, nhanh, thẳng"], a: 0}, 
        {q: "Kết quả ngắm chụm xếp loại Giỏi nếu ba điểm chấm nằm trong vòng tròn, đường kính", options: ["2 mm.", "3 mm.", "4 mm.", "5 mm."], a: 0}, 
        {q: "Kết quả ngắm chụm xếp loại Đạt nếu ba điểm chấm nằm trong vòng tròn, đường kính", options: ["7 mm.", "8 mm.", "9 mm.", "10 mm."], a: 3}, 
        {q: "Khung bia nền trắng (để dán bia số 4) có kích thước là", options: ["70 cm x 70 cm.", "75 cm x 75 cm.", "80 cm x 80 cm.", "85 cm x 85 cm."], a: 1}, 
        {q: "Cự li bắn bia mục tiêu số 4 là", options: ["150 m.", "130 m.", "120 m.", "100 m."], a: 3}, 
        {q: "Trong bài bắn vào mục tiêu bia số 4, kết quả bắn xếp loại Không đạt nếu tổng số điểm sau 3 phát bắn dưới", options: ["15 điểm.", "16 điểm.", "17 điểm.", "18 điểm."], a: 0}, 
        {q: "Tác GIẢ của Web này là người thích bánh mì Pita đúng hay sai?", options: ["Đúng", "Sai"], a: 0},
        
        // --- 4 CÂU HỎI MỚI (Đã thêm câu 19/8/1945) ---
        {q: "Ngày hội Quốc phòng toàn dân là ngày nào?", options: ["19/08", "22/12", "02/09", "19/05"], a: 1},
        {q: "Bộ trưởng Bộ Công an hiện nay là ai?", options: ["Tô Lâm", "Lương Tam Quang", "Phạm Minh Chính", "Nguyễn Phú Trọng"], a: 1},
        {q: "Bộ trưởng Bộ Quốc phòng hiện nay là ai?", options: ["Phan Văn Giang", "Ngô Xuân Lịch", "Lương Cường", "Phùng Quang Thanh"], a: 0},
        // Câu hỏi mới được thêm vào đây:
        {q: "Ngày thành lập Công an nhân dân Việt Nam là ngày nào?", options: ["22/12/1944", "19/08/1945", "03/02/1930", "02/09/1945"], a: 1}
    ];

    let quizData = [];
    let currentIdx = 0;
    let userAnswers = [];
    let score = 0;
    let timerInterval;
    let timeLeft = 0;
    let userName = "";
    let currentMode = 'practice';
    let isExamFinished = false;

    function selectMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`mode-${mode}`).classList.add('active');
    }

    function shuffleArray(array) {
        let arr = JSON.parse(JSON.stringify(array)); 
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    function startQuiz() {
        if (!document.getElementById('username').value.trim()) { alert("Vui lòng nhập tên chiến sĩ!"); return; }
        userName = document.getElementById('username').value;
        document.getElementById('user-display').innerText = userName;

        const yt = document.getElementById('yt-link').value;
        if(yt) {
            const vid = yt.match(/(?:youtu\.be\/|youtube\.com\/(?:.*v=|.*\/))([^&?]*)/)?.[1];
            if(vid) document.getElementById('yt-wrapper').innerHTML = `<iframe src="https://www.youtube.com/embed/${vid}?autoplay=1&loop=1&playlist=${vid}" allow="autoplay"></iframe>`;
        }

        document.getElementById('start-screen').style.display = 'none';
        
        // Fade in main app
        const app = document.getElementById('main-app');
        app.style.opacity = '1';
        app.style.filter = 'none';
        
        if (currentMode === 'practice') {
            quizData = originalBank;
            timeLeft = 45 * 60;
            document.getElementById('mode-display').innerText = "CHẾ ĐỘ: LUYỆN TẬP";
            document.getElementById('live-score-box').style.display = 'flex';
        } else {
            let shuffled = shuffleArray(originalBank);
            quizData = shuffled.slice(0, 30);
            timeLeft = 30 * 60;
            document.getElementById('mode-display').innerText = "CHẾ ĐỘ: THI THỰC CHIẾN";
            document.getElementById('live-score-box').style.display = 'none';
        }

        userAnswers = new Array(quizData.length).fill(null);
        
        initGrid();
        loadQuestion(0);
        
        timerInterval = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60), s = timeLeft%60;
            let t = `${m}:${s<10?'0':''}${s}`;
            document.getElementById('timer-desktop').innerText = t;
            document.getElementById('timer-mobile').innerText = t;
            if(timeLeft<=0) confirmFinish(true);
        }, 1000);
    }

    function initGrid() {
        const grid = document.getElementById('q-grid');
        grid.innerHTML = '';
        quizData.forEach((_, i) => {
            let d = document.createElement('div');
            d.className = 'q-dot';
            d.id = `dot-${i}`;
            d.innerText = i+1;
            d.onclick = () => { loadQuestion(i); if(window.innerWidth<=900) toggleMenu(); };
            grid.appendChild(d);
        });
    }

    function loadQuestion(i) {
        currentIdx = i;
        document.getElementById('q-current-txt').innerText = `Câu ${i+1}/${quizData.length}`;
        document.querySelectorAll('.q-dot').forEach(e => e.classList.remove('active'));
        document.getElementById(`dot-${i}`).classList.add('active');

        // Animation reset
        const contentArea = document.getElementById('q-content-area');
        contentArea.classList.remove('fade-in-up');
        void contentArea.offsetWidth; // Trigger reflow
        contentArea.classList.add('fade-in-up');

        let q = quizData[i];
        let html = `<div class="q-text">${q.q}</div><div class="opt-list">`;
        
        q.options.forEach((opt, idx) => {
            let cls = 'opt-btn';
            
            if (currentMode === 'practice' || isExamFinished) {
                if(userAnswers[i] !== null) {
                    cls += ' disabled';
                    if(idx === q.a) cls += ' correct';
                    else if(idx === userAnswers[i]) cls += ' wrong';
                }
            } else {
                if(userAnswers[i] === idx) cls += ' selected';
            }

            html += `<div class="${cls}" onclick="check(${idx})"><span class="opt-char">${String.fromCharCode(65+idx)}</span><span>${opt}</span></div>`;
        });
        contentArea.innerHTML = html + `</div>`;
    }

    function check(opt) {
        if(currentMode === 'practice' && userAnswers[currentIdx] !== null) return;
        if(currentMode === 'exam' && isExamFinished) return;

        userAnswers[currentIdx] = opt;
        
        let correct = quizData[currentIdx].a;
        let dot = document.getElementById(`dot-${currentIdx}`);
        
        if (currentMode === 'practice') {
            if(opt === correct) { score++; dot.classList.add('correct'); }
            else dot.classList.add('wrong');
            document.getElementById('score-display').innerText = `${score} / ${quizData.length}`;
            
            // Smoothly update UI without full reload
            let btns = document.querySelectorAll('.opt-btn');
            btns.forEach((btn, idx) => {
                btn.classList.add('disabled');
                if(idx === correct) btn.classList.add('correct');
                else if(idx === opt) btn.classList.add('wrong');
            });
        } else {
            dot.classList.add('answered');
            let btns = document.querySelectorAll('.opt-btn');
            btns.forEach(b => b.classList.remove('selected'));
            btns[opt].classList.add('selected');
        }
    }

    function changeQuestion(d) {
        let n = currentIdx + d;
        if(n >= 0 && n < quizData.length) loadQuestion(n);
    }

    function confirmFinish(force = false) {
        if(isExamFinished && currentMode === 'exam') return;
        if(!force && !confirm("Bạn có chắc chắn muốn nộp bài không?")) return;

        clearInterval(timerInterval);

        if (currentMode === 'practice') {
            alert(`KẾT THÚC!\nĐiểm: ${(score/quizData.length*10).toFixed(1)}`);
            location.reload();
        } else {
            isExamFinished = true;
            let rawScore = 0;
            quizData.forEach((q, i) => {
                if(userAnswers[i] === q.a) rawScore++;
            });
            let finalScore = (rawScore / 30) * 10;
            let displayScore = finalScore.toFixed(1);
            if (displayScore.endsWith('.0')) displayScore = Math.round(finalScore);

            document.getElementById('result-modal').style.display = 'flex';
            document.getElementById('res-score').innerText = `${displayScore} / 10`;

            let msg = "";
            let imgBox = document.getElementById('res-img');
            imgBox.style.display = 'none';

            if(parseFloat(displayScore) === 10) {
                msg = "Cậu đã rất xuất sắc! Gửi cậu một con chim sáo tượng trưng cho sự may mắn.";
                imgBox.style.display = 'block';
            } else if (parseFloat(displayScore) >= 7) {
                msg = "Cảm ơn cậu đã tham gia, cậu đã cố gắng lắm rồi, vậy là tốt rồi đừng lo nhé.";
            } else {
                msg = "Hãy cố gắng hơn ở lần sau nhé! Kiến thức vẫn đang chờ cậu chinh phục.";
            }
            document.getElementById('res-msg').innerText = msg;
        }
    }

    function reviewQuiz() {
        document.getElementById('result-modal').style.display = 'none';
        quizData.forEach((q, i) => {
            let dot = document.getElementById(`dot-${i}`);
            dot.classList.remove('answered');
            if (userAnswers[i] === q.a) dot.classList.add('correct');
            else dot.classList.add('wrong');
        });
        loadQuestion(0);
    }

    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('open');
        document.getElementById('overlay-bg').classList.toggle('show');
    }
</script>
</body>
</html>
